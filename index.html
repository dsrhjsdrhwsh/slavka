<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Generator linku — apeczkamoja1</title>

  <style>
    body { font-family: Arial, sans-serif; padding: 24px; background:#f2f2f2; color:#111; }
    h1 { margin: 0 0 12px 0; font-size:22px; }
    form { display:grid; grid-template-columns: 1fr 1fr; gap:10px; max-width:1100px; }
    label { display:block; font-size:13px; margin-bottom:6px; }
    input[type="text"], input[type="file"], select {
      width:100%; padding:8px; border:1px solid #ccc; border-radius:6px; background:white;
    }
    .full { grid-column: 1 / -1; }
    .controls { display:flex; gap:8px; margin-top:10px; }
    button {
      padding:8px 12px; border-radius:8px; border:0; cursor:pointer;
      background:#0b63d6; color:white; font-size:14px;
    }
    button.secondary { background:#666; }
    button.ghost { background:transparent; color:#0b63d6; border:1px solid #0b63d6; }
    #result { margin-top:14px; background:white; padding:12px; border:1px dashed #ccc; border-radius:8px; word-break:break-all; }
    #preview { margin-top:12px; display:flex; gap:12px; align-items:flex-start; }
    #preview img { max-width:200px; max-height:260px; border-radius:8px; border:1px solid #ddd; object-fit:cover; }
    .hint { font-size:13px; color:#555; margin-bottom:8px; }
    footer { margin-top:18px; font-size:13px; color:#666; }
  </style>
</head>

<body>
  <h1>Generator linku do kreatora dokumentu</h1>
  <p class="hint">Wpisz dane, dodaj zdjęcie i kliknij <strong>Wygeneruj link</strong>.</p>

  <form id="form">

    <div><label>Imię</label><input type="text" id="name"></div>
    <div><label>Nazwisko</label><input type="text" id="surname"></div>

    <div>
      <label>Płeć</label>
      <select id="sex">
        <option value=""></option>
        <option value="m">Mężczyzna</option>
        <option value="f">Kobieta</option>
      </select>
    </div>

    <div><label>Data urodzenia (DD.MM.RRRR)</label><input type="text" id="birthday"></div>

    <div>
      <label>PESEL</label>
      <input type="text" id="pesel">
      <button type="button" id="genPesel" style="margin-top:6px; width:100%;">Wygeneruj PESEL</button>
    </div>

    <label for="mdow_series">Seria i numer dokumentu:</label>
<input type="text" id="mdow_series" value="MWYC 24561">

<button type="button" onclick="losujDokument()" style="margin-top:5px;">
    Wylosuj numer dokumentu
</button>

<script>
function losujDokument() {
    // Losowanie 3–4 liter (jak w polskich dokumentach)
    const litery = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const dlugoscLiter = Math.random() < 0.5 ? 3 : 4;
    let seria = "";
    for (let i = 0; i < dlugoscLiter; i++) {
        seria += litery[Math.floor(Math.random() * litery.length)];
    }

    // Losowanie 5 cyfr
    let cyfry = Math.floor(10000 + Math.random() * 90000);

    // Wstawienie wyniku
    document.getElementById("mdow_series").value = `${seria} ${cyfry}`;
}
</script>

    <div><label>Data wydania</label><input type="text" id="issue_date"></div>
    <div><label>Data ważności</label><input type="text" id="expiry_date"></div>
    <div><label>Imię ojca</label><input type="text" id="father_name"></div>
    <div><label>Imię matki</label><input type="text" id="mother_name"></div>
    <div><label>Obywatelstwo</label><input type="text" id="nationality"></div>
    <div><label>Miejsce urodzenia</label><input type="text" id="birthPlace"></div>
    <div><label>Kraj urodzenia</label><input type="text" id="countryOfBirth"></div>
    <div><label>Adres – ulica</label><input type="text" id="adress1"></div>
    <div><label>Adres – kod pocztowy</label><input type="text" id="adress2"></div>
    <div><label>Miejscowość</label><input type="text" id="city"></div>
    <div><label>Data zameldowania</label><input type="text" id="home_date"></div>
    <div><label>Nazwisko rodowe</label><input type="text" id="familyName"></div>
    <div><label>Nazwisko rodowe ojca</label><input type="text" id="fathersFamilyName"></div>
    <div><label>Nazwisko rodowe matki</label><input type="text" id="mothersFamilyName"></div>

    <div class="full">
      <label>Adres URL zdjęcia</label>
      <input type="text" id="image">
    </div>

    <div class="full">
      <label>lub wgraj zdjęcie z komputera</label>
      <input type="file" id="imageFile" accept="image/*">
    </div>

    <div class="full controls">
      <button type="button" id="generate">Wygeneruj link</button>
      <button type="button" id="open" class="secondary">Otwórz</button>
      <button type="button" id="copy" class="ghost">Kopiuj</button>
    </div>

  </form>

  <div id="result"><strong>Wynik:</strong> <div id="linkOutput"></div></div>

  <div id="preview">
    <div>
      <strong>Podgląd zdjęcia:</strong><br>
      <img id="imgPreview" style="display:none;">
    </div>
  </div>

  <footer>Docelowy kreator: <code>https://cytruse.github.io/apeczkamoja1/id.html</code></footer>

  <script>
    const BASE = "https://cytruse.github.io/apeczkamoja1/id.html";

    const fields = [
      "name","surname","sex","birthday","pesel","mdow_series",
      "issue_date","expiry_date","father_name","mother_name",
      "nationality","birthPlace","countryOfBirth","adress1",
      "adress2","city","home_date","familyName","fathersFamilyName",
      "mothersFamilyName","image"
    ];

    // >>> GENERATOR PESELU <<<
    function generatePeselFromDate(date) {
      const [d, m, y] = date.split(".").map(Number);
      if (!d || !m || !y) return "";

      let year = y % 100;
      let month = m;

      if (y >= 2000) month += 20;
      if (y >= 2100) month += 40;

      const base = 
        String(year).padStart(2,"0") +
        String(month).padStart(2,"0") +
        String(d).padStart(2,"0");

      const random = String(Math.floor(Math.random()*10000)).padStart(4,"0");

      const raw = base + random;

      const weights = [1,3,7,9,1,3,7,9,1,3];
      let sum = 0;

      for (let i=0;i<10;i++) sum += weights[i] * Number(raw[i]);
      const control = (10 - (sum % 10)) % 10;

      return raw + control;
    }

    document.getElementById("genPesel").onclick = () => {
      const d = document.getElementById("birthday").value.trim();
      if (!d) return alert("Najpierw wpisz datę urodzenia!");

      const pesel = generatePeselFromDate(d);
      document.getElementById("pesel").value = pesel;
    };

    // >>> GENEROWANIE LINKU <<<
    function buildLink() {
      const p = new URLSearchParams();
      fields.forEach(f => {
        const v = document.getElementById(f).value.trim();
        if (v) p.set(f, v);
      });
      return BASE + "?" + p.toString();
    }

    document.getElementById("generate").onclick = () => {
      document.getElementById("linkOutput").textContent = buildLink();
    };

    document.getElementById("open").onclick = () => {
      window.open(buildLink(), "_blank");
    };

    document.getElementById("copy").onclick = async () => {
      await navigator.clipboard.writeText(buildLink());
      alert("Skopiowano!");
    };

    // >>> ZDJĘCIE <<<
    const imageInput = document.getElementById("image");
    const imageFile = document.getElementById("imageFile");
    const imgPreview = document.getElementById("imgPreview");

    imageInput.oninput = () => {
      imgPreview.src = imageInput.value;
      imgPreview.style.display = "block";
    };

    imageFile.onchange = () => {
      const file = imageFile.files[0];
      const r = new FileReader();
      r.onload = e => {
        imageInput.value = e.target.result;
        imgPreview.src = e.target.result;
        imgPreview.style.display = "block";
      };
      r.readAsDataURL(file);
    };
  </script>

</body>
</html>
